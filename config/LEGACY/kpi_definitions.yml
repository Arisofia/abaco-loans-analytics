# Canonical KPI Definitions
# Each KPI includes: formula, data sources, thresholds, and business owner
#
# Threshold semantics:
# - For "higher-is-bad" KPIs (risk, compliance): threshold is a maximum acceptable value (warn/critical if value > threshold)
# - For "higher-is-good" KPIs (growth, liquidity): threshold is a minimum acceptable value (warn/critical if value < threshold)
#
# Note: Growth KPI uses critical: 0.02 < warning: 0.05 intentionally, meaning critical if growth < 2%, warning if growth < 5%.

risk:
  name: Portfolio Risk
  formula: 'sum(defaulted_loans) / sum(total_loans)'
  formula_language: 'Python'  # Aggregation over portfolio-wide data; nulls treated as zero
  data_sources:
    - loan_core
    - payments
  threshold:
    warning: 0.03
    critical: 0.05
  owner: CRO

growth:
  name: Loan Book Growth
  formula: 'sum(new_loans_amount) / sum(previous_loans_amount)'
  formula_language: 'Python'  # Aggregation over portfolio-wide data; nulls treated as zero
  data_sources:
    - loan_core
  threshold:
    warning: 0.05
    critical: 0.02
  owner: Head of Growth

liquidity:
  name: Liquidity Ratio
  formula: 'cash_on_hand / short_term_liabilities'
  formula_language: 'Python'  # Portfolio-wide snapshot; nulls treated as zero
  data_sources:
    - external_macro
    - loan_core
  threshold:
    warning: 1.2
    critical: 1.0
  owner: CFO

compliance:
  name: Compliance Breaches
  formula: 'count(breaches)'
  formula_language: 'Python'  # Portfolio-wide count; nulls ignored
  data_sources:
    - compliance_logs
  threshold:
    warning: 1
    critical: 3
  owner: Compliance Officer

schemas:
  loan_core:
    - defaulted_loans
    - total_loans
    - new_loans_amount
    - previous_loans_amount
    - cash_on_hand
    - short_term_liabilities
  payments: []
  external_macro:
    - cash_on_hand
    - short_term_liabilities
  compliance_logs:
    - breaches

  # --- Auto-generated missing schemas from KPI mapping table ---
  traction.total_customers: []
  traction.total_loans: []
  traction.total_volume_usd: []
  traction.monthly_active_clients_latest: []
  traction.outstanding_balance_usd: []
  traction.growth_metrics: []
  delinquency.par90_latest: []
  delinquency.par7_latest: []
  delinquency.portfolio_at_risk_30dpd: []
  delinquency.total_balance: []
  delinquency.par_metrics: []
  collections.collection_rate_latest: []
  collections.total_payments_received_latest: []
  total_payments_scheduled_latest: []
  collections.collection_metrics: []
  curves.cdr_latest: []
  curves.written_off_amount: []
  curves.starting_balance: []
  curves.liquidation_rate: []
  characteristics.average_apr: []
  characteristics.average_loan_size_usd: []
  characteristics.interest_rate_distribution: []
  cashflow_simulation.*: []
  financials.balance_sheet: []
  financials.balance_sheet.cash_balance_usd: []
  financials.balance_sheet.net_worth_usd: []
  financials.income_statement.net_income_usd: []
  financials.income_statement.runway_months: []
  financials.income_statement.debt_to_equity_ratio: []
  data_quality.data_freshness_hours: []
  data_completeness_pct: []
  data_quality.validation_status: []
