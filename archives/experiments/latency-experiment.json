{
  "version": "1.0.0",
  "title": "Add latency to downstream dependency and verify alerts",
  "description": "Simulate elevated latency on a critical dependency to ensure service-level alerts fire and the system remains responsive within tolerance.",
  "steady-state-hypothesis": {
    "title": "Service remains healthy under slight latency",
    "probes": [
      {
        "name": "target-responds-fast-enough",
        "type": "probe",
        "tolerance": {
          "type": "jsonpath",
          "path": "$.elapsed_ms",
          "within": {
            "type": "range",
            "start": 0,
            "end": {"ref": "max_latency_ms"}
          }
        },
        "provider": {
          "type": "http",
          "url": "${CHAOS_TARGET_URL:-https://example.com/health}",
          "timeout": 5,
          "verify_tls": true
        }
      }
    ]
  },
  "method": [
    {
      "name": "inject-latency",
      "type": "action",
      "provider": {
        "type": "process",
        "path": "toxiproxy-cli",
        "arguments": [
          "latency",
          "--toxicName=experiment-latency",
          "--toxicType=latency",
          "--toxicity=1",
          "--latency=500",
          "--jitter=200",
          "--upstream=127.0.0.1:8080"
        ]
      }
    },
    {
      "type": "probe",
      "name": "check-alerting-endpoint",
      "tolerance": true,
      "provider": {
        "type": "http",
        "url": "${CHAOS_ALERT_URL:-https://example.com/alerts/status}",
        "timeout": 5,
        "verify_tls": true
      }
    }
  ],
  "rollbacks": [
    {
      "name": "remove-latency",
      "type": "action",
      "provider": {
        "type": "process",
        "path": "toxiproxy-cli",
        "arguments": ["remove", "experiment-latency"]
      }
    }
  ],
  "configuration": {
    "max_latency_ms": ${CHAOS_BASELINE_MS:-450}
  }
}
