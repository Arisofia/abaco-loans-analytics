name: Operations Dashboard
on:
  schedule:
    - cron: "0 */6 * * *" # Every 6 hours
  workflow_dispatch:

env:
  SUPABASE_SERVICE_ROLE: ${{ secrets.SUPABASE_SERVICE_ROLE }}
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
  SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}

jobs:
  operations-dashboard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python Environment
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
      - name: Run Operations Analysis
        if: hashFiles('scripts/operations_dashboard.py') != ''
        run: |
          python scripts/operations_dashboard.py
      - name: Post to Slack
        if: hashFiles('scripts/post_to_slack.py') != '' && env.SLACK_BOT_TOKEN != ''
        run: |
          python scripts/post_to_slack.py --channel "#ops-dashboard"
