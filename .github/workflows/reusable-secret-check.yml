name: Reusable Secret Check

on:
  workflow_call:
    inputs:
      secret_names:
        description: 'A comma-separated list of secret names to check for presence.'
        required: true
        type: string
    outputs:
      all_secrets_present:
        description: "Returns 'true' if all specified secrets are present."
        value: ${{ jobs.check.outputs.all_present }}

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      all_present: ${{ steps.validate.outputs.all_present }}
    steps:
      - id: validate
        env:
          SECRETS_CONTEXT: ${{ toJSON(secrets) }}
          REQUIRED_SECRETS: ${{ inputs.secret_names }}
        shell: bash
        run: |
          all_present="true"
          # The jq tool is pre-installed on GitHub runners
          for secret_name in $(echo $REQUIRED_SECRETS | tr ',' ' '); do
            if ! echo "$SECRETS_CONTEXT" | jq -e --arg key "$secret_name" '.[$key] and .[$key] != ""' > /dev/null; then
              echo "❌ Secret '$secret_name' is missing or empty."
              all_present="false"
            else
              echo "✅ Secret '$secret_name' is present."
            fi
          done
          echo "all_present=$all_present" >> "$GITHUB_OUTPUT"
