name: Reusable Secret Check

on:
  workflow_call:
    inputs:
      secrets:
        required: true
        type: string

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    outputs:
      all_secrets_present: ${{ steps.check.outputs.all_secrets_present }}
      missing: ${{ steps.check.outputs.missing }}
    steps:
      - name: Check secrets list
        id: check
        shell: bash
        run: |
          set -euo pipefail
          IFS=',' read -ra NAMES <<< "${{ inputs.secrets }}"
          missing_list=()
          for name in "${NAMES[@]}"; do
            if [ -z "${!name:-}" ]; then
              missing_list+=("$name")
            fi
          done
          if [ ${#missing_list[@]} -gt 0 ]; then
            printf '%s,' "${missing_list[@]}" | sed 's/,$//' > /tmp/missing.txt
            echo "Missing required secrets: $(cat /tmp/missing.txt)" >&2
            exit 1
          else
            echo "all_secrets_present=true" >> $GITHUB_OUTPUT
            echo "missing=" >> $GITHUB_OUTPUT
          fi
      - name: Output results
        run: |
          echo "All secrets present: ${{ steps.check.outputs.all_secrets_present }}"
          if [ -n "${{ steps.check.outputs.missing }}" ]; then
            echo "Missing secrets: ${{ steps.check.outputs.missing }}"
          fi
